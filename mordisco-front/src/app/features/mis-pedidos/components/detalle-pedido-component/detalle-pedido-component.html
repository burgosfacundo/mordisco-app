<article class="card-base flex flex-col">
  <!-- Header con estado y fecha -->
  <div class="bg-linear-to-r from-primary-500 to-primary-600 p-6">
    <div class="flex flex-col gap-3">
      <!-- Badges de estado y tipo de entrega -->
      @if(pedidoResponse()) { 
        <div class="flex items-center gap-2 flex-wrap">
      <span [class]="getEstadoBadgeClass()">
        <span class="material-icons text-sm">{{ getEstadoIcon() }}</span>
        {{ getEstadoLabel() }}
        <br>
        @if(pedidoResponse()?.estado === estadoPedidoEnum.LISTO_PARA_ENTREGAR){
          Buscando repartidor...
        }@else if (pedidoResponse()?.estado === estadoPedidoEnum.ASIGNADO_A_REPARTIDOR) {
          {{pedidoResponse()?.repartidor?.nombre}} {{pedidoResponse()?.repartidor?.apellido}}
        }@else if (pedidoResponse()?.estado === estadoPedidoEnum.EN_CAMINO) {
          {{pedidoResponse()?.repartidor?.nombre}} {{pedidoResponse()?.repartidor?.apellido}} con tu pedido
        }
      </span>
          <span class="px-3 py-1.5 rounded-full text-xs font-semibold uppercase tracking-wide
                       bg-white text-primary-600 shadow-md">
            {{ formatearEntrega(pedidoResponse()!) }}
          </span>
        </div>

        @if(pedidoResponse()?.bajaLogica){
          <p class="text-xs text-white uppercase tracking-wide font-semibold"> Pedido cancelado por administrador</p>
          <p class="text-xs text-white uppercase tracking-wide ">{{pedidoResponse()?.motivoBaja}}</p>
        }
      }
      
      <!-- Restaurante y fecha -->
      <div class="flex items-center justify-between">
        <h3 class="text-white font-bold text-lg truncate">
          {{ pedidoResponse()?.restaurante?.razonSocial }}
        </h3>
        <span class="text-white/90 text-sm font-medium">
          Pedido #{{ pedidoResponse()?.id }}
        </span>
      </div>
      
      <div class="text-white/80 text-sm">
        {{ pedidoResponse()?.fechaHora | date:'dd/MM/yyyy HH:mm' }}
      </div>
    </div>
  </div>

  <!-- Contenido del pedido - SIN flex-1 para evitar expansi贸n excesiva -->
  <div class="p-6 flex flex-col gap-4">
    
    <!-- Lista de productos -->
    <div class="pb-4 border-b border-gray-200">
      <h4 class="font-semibold text-gray-900 mb-3 text-sm uppercase tracking-wide">
        Productos ({{ pedidoResponse()?.productos?.length }})
      </h4>
      <ul class="space-y-2">
        @for (producto of pedidoResponse()?.productos; track producto.idProducto) {
          <li class="flex items-center justify-between text-sm">
            <div class="flex items-center gap-2 flex-1 min-w-0">
              <span class="inline-flex items-center justify-center w-6 h-6 rounded-full 
                           bg-primary-100 text-primary-700 font-bold text-xs shrink-0">
                {{ producto.cantidad }}
              </span>
              <span class="text-gray-700 truncate">{{ producto.nombreProducto }}</span>
            </div>
            <span class="text-gray-900 font-semibold ml-2 shrink-0">
              ${{ producto.precioUnitario * producto.cantidad | number:'1.2-2' }}
            </span>
          </li>
        }
      </ul>
    </div>

    <!-- Direcci贸n de entrega (solo si es delivery Y tiene direcci贸n) -->
    @if (pedidoResponse()?.tipoEntrega === tipoEntregaEnum.DELIVERY && pedidoResponse()?.direccionEntrega) {
      <div class="pb-4 border-b border-gray-200">
        <h4 class="font-semibold text-gray-900 mb-2 text-sm uppercase tracking-wide">
          Direcci贸n de Entrega
        </h4>
        <p class="text-sm text-gray-700 leading-relaxed">
          {{ obtenerDireccionCompleta() }}
        </p>
        @if (pedidoResponse()?.direccionEntrega?.referencias) {
          <p class="text-xs text-gray-500 mt-1 italic"> 
            Ref: {{ pedidoResponse()?.direccionEntrega?.referencias }}
          </p>
        }
      </div>
    }
        <!-- Si es RETIRO_POR_LOCAL, mostrar direcci贸n del restaurante -->
    @if (pedidoResponse()?.tipoEntrega === tipoEntregaEnum.RETIRO_POR_LOCAL) {
      <div class="pb-4 border-b border-gray-200">
        <h4 class="font-semibold text-gray-900 mb-2 text-sm uppercase tracking-wide flex items-center gap-2">
          <mat-icon class="text-primary-600">store</mat-icon>
          Retiro en Local
        </h4>
        <p class="text-sm text-gray-700 leading-relaxed">
          {{ obtenerDireccionCompleta() }}
        </p>
        <p class="text-xs text-gray-500 mt-2 italic">
          Recuerda llevar tu DNI al retirar el pedido
        </p>
      </div>
    }
    <!-- Informaci贸n del Repartidor (si est谩 asignado) -->
    @if (pedidoResponse()?.repartidor && pedidoResponse()?.tipoEntrega === tipoEntregaEnum.DELIVERY) {
      <div class="pb-4 border-b border-gray-200">
        <h4 class="font-semibold text-gray-900 mb-2 text-sm uppercase tracking-wide flex items-center gap-2">
          <mat-icon class="text-green-600">delivery_dining</mat-icon>
          Repartidor Asignado
        </h4>
        <p class="text-sm font-semibold text-gray-900 mb-1">
          {{ pedidoResponse()?.repartidor?.nombre }} {{ pedidoResponse()?.repartidor?.apellido }}
        </p>
        <p class="text-sm text-gray-700">
          <span class="font-semibold">Tel茅fono:</span> {{ pedidoResponse()?.repartidor?.telefono }}
        </p>
      </div>
    }    
    @if(pedidoResponse()?.estado !== estadoPedidoEnum.CANCELADO &&  pedidoResponse()?.estado !== estadoPedidoEnum.COMPLETADO && pedidoResponse()?.estado !== estadoPedidoEnum.PENDIENTE){
      <div class="mt-3 bg-linear-to-br from-amber-50 to-amber-100 rounded-xl p-3 shadow-lg border-2 border-amber-300">
        <div class="flex items-center gap-1"> 
          <p class="text-sm font-bold text-amber-900 tracking-widest font-mono">
             PIN de Verificaci贸n {{ pedidoResponse()?.pin?.toUpperCase() }}
          </p>
        </div>
      </div>
    }






    <!-- Total - con margin-top auto para empujar hacia abajo -->
    <div class="flex items-center justify-between pt-2 mt-auto">
      <span class="font-bold text-gray-900 text-lg">Total:</span>
      <span class="font-bold text-primary-600 text-2xl">
        ${{ pedidoResponse()?.total | number:'1.2-2' }}
      </span>
    </div>

    <!-- Botones de acci贸n -->
    <div class="flex flex-col gap-2">
      @if (mostrarBotonCancelar()) {
        <button 
          (click)="cancelarPedido()"
          class="w-full py-2.5 rounded-lg
                 bg-red-50 text-red-700 font-semibold text-sm
                 hover:bg-red-100 active:scale-95
                 transition-all duration-200
                 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2">
          Cancelar Pedido
        </button>
      } 

      @if (mostrarBotonDetalles()) {
        <button 
          (click)="verDetalles()"
          class="w-full py-2.5 rounded-lg
                 bg-primary-50 text-primary-700 font-semibold text-sm
                 hover:bg-primary-100 active:scale-95
                 transition-all duration-200
                 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2">
          Ver Detalles
        </button>
      }
    </div>
  </div>
</article>