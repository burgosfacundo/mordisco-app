<div class="container mx-auto px-4 py-6 max-w-7xl">
  <!-- Header con título y controles -->
  <div class="mb-6">
    <div class="flex items-center justify-between mb-4">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">Pedidos Disponibles</h1>
        <p class="text-sm text-gray-600 mt-1">Acepta pedidos y comienza a entregar</p>
      </div>

      <!-- Botón de recarga manual -->
      <button
        (click)="recargarPedidos()"
        [disabled]="isLoading()"
        class="flex items-center gap-2 px-4 py-2 rounded-lg bg-white border-2 border-gray-300 text-gray-700 hover:border-primary-500 hover:text-primary-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
      >
        <svg
          [class.animate-spin]="isLoading()"
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
          />
        </svg>
        <span class="font-semibold">Actualizar</span>
      </button>
    </div>

    <!-- Indicador de última actualización -->
    <div class="flex items-center gap-2 text-xs text-gray-500">
      <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
      <span
        >Auto-actualización activa • Última actualización: {{ getTiempoDesdeActualizacion() }}</span
      >
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading() && pedidosDisponibles().length === 0) {
  <div class="flex flex-col items-center justify-center py-16">
    <div
      class="w-16 h-16 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mb-4"
    ></div>
    <p class="text-gray-600 font-semibold">Cargando pedidos disponibles...</p>
  </div>
  }

  <!-- Empty State -->
  @else if (pedidosDisponibles().length === 0) {
  <div class="text-center py-16">
    <div class="w-24 h-24 mx-auto mb-6 rounded-full bg-gray-100 flex items-center justify-center">
      <svg class="w-12 h-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"
        />
      </svg>
    </div>
    <h3 class="text-xl font-bold text-gray-900 mb-2">No hay pedidos disponibles</h3>
    <p class="text-gray-600">Los nuevos pedidos aparecerán aquí automáticamente</p>
  </div>
  }

  <!-- Lista de Pedidos -->
  @else {
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    @for (pedido of pedidosDisponibles(); track pedido.id) {
    <article
      class="bg-white rounded-xl shadow-md overflow-hidden transition-all duration-300 hover:shadow-xl hover:-translate-y-1 flex flex-col h-full border-2 border-transparent hover:border-primary-200"
    >
      <!-- Header con ID y Badge urgente -->
      <div
        class="bg-linear-to-r from-primary-50 to-primary-100 px-6 py-4 border-b border-primary-200"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-xs text-primary-600 uppercase tracking-wide font-semibold">Pedido</p>
            <p class="text-2xl font-bold text-gray-900">#{{ pedido.id }}</p>
          </div>
          <!-- @if (pedido.tiempoEstimado <= 15) {
                <span class="px-3 py-1 rounded-full text-xs font-bold
                             bg-red-100 text-red-700 animate-pulse">
                  ¡Urgente!
                </span>
              }-->
        </div>
      </div>

      <!-- Content -->
      <div class="p-6 flex-1 flex flex-col space-y-4">
        <!-- Restaurante -->
        <div class="flex items-start gap-3">
          <div
            class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center shrink-0"
          >
            <svg
              class="w-5 h-5 text-orange-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
              />
            </svg>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-xs text-gray-500 uppercase tracking-wide font-semibold">Retirar en</p>
            <p class="text-sm font-bold text-gray-900">
              {{ pedido.restaurante.razonSocial }}
            </p>
            <p class="text-xs text-gray-600 mt-0.5">
              {{ pedido.restaurante.direccion.calle }} {{ pedido.restaurante.direccion.numero }}
            </p>
          </div>
        </div>

        <!-- Dirección de Entrega -->
        <div class="flex items-start gap-3">
          <div
            class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center shrink-0"
          >
            <svg
              class="w-5 h-5 text-green-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
              />
            </svg>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-xs text-gray-500 uppercase tracking-wide font-semibold">Entregar en</p>
            <p class="text-sm font-bold text-gray-900">
              {{ pedido.direccionEntrega?.calle }} {{ pedido.direccionEntrega?.numero }}
            </p>
            <p class="text-xs text-gray-600 mt-0.5">
              {{ pedido.cliente.nombre }} {{ pedido.cliente.apellido }}
            </p>
          </div>
        </div>

        <!-- Métricas en Cards -->
        <div class="grid grid-cols-3 gap-2 mt-2">
          <!-- Distancia -->
          <div class="bg-blue-50 rounded-lg p-3 text-center">
            <svg
              class="w-5 h-5 text-blue-600 mx-auto mb-1"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"
              />
            </svg>
            <p class="text-xs text-gray-600 font-semibold">Distancia</p>
            @if (pedido.distanciaFormateada) {
            <p class="text-lg font-bold text-blue-700">{{ pedido.distanciaFormateada }}</p>
            } @else {
            <p class="text-xs text-gray-400">N/D</p>
            }
          </div>

          <!-- Tiempo -->
          <div class="bg-purple-50 rounded-lg p-3 text-center">
            <svg
              class="w-5 h-5 text-purple-600 mx-auto mb-1"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <p class="text-xs text-gray-600 font-semibold">Tiempo</p>
            <p class="text-lg font-bold text-purple-700">~30 min</p>
          </div>

          <!-- Pago -->
          <div class="bg-green-50 rounded-lg p-3 text-center">
            <svg
              class="w-5 h-5 text-green-600 mx-auto mb-1"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <p class="text-xs text-gray-600 font-semibold">Ganarás</p>
            <p class="text-lg font-bold text-green-700">
              ${{ pedido.costoDelivery ? (pedido.costoDelivery * 0.8).toFixed(2) : ((pedido.total * 0.2) * 0.8).toFixed(2) }}
            </p>
          </div>
        </div>

        <!-- Total del Pedido -->
        <div class="mt-2 pt-4 border-t border-gray-200">
          <div class="flex items-center justify-between">
            <span class="text-sm font-semibold text-gray-600 uppercase tracking-wide"
              >Total del pedido</span
            >
            <span class="text-xl font-bold text-gray-900">
              ${{ pedido.total | number : '1.2-2' }}
            </span>
          </div>
        </div>
      </div>

      <!-- Footer con botón de acción -->
      <div class="px-6 pb-6 pt-2 space-y-2">
        <button
          (click)="onAceptarPedido(pedido)"
          class="w-full py-3 rounded-lg bg-linear-to-r from-primary-500 to-primary-600 text-white font-bold text-base hover:from-primary-600 hover:to-primary-700 active:scale-95 shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
        >
          Aceptar Pedido
        </button>
        <button
          (click)="onVerDetalles(pedido)"
          class="w-full py-3 rounded-lg bg-linear-to-r from-primary-500 to-primary-600 text-white font-bold text-base hover:from-primary-600 hover:to-primary-700 active:scale-95 shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
        >
          Ver Detalles
        </button>
      </div>
    </article>
    }
  </div>
  }
</div>
